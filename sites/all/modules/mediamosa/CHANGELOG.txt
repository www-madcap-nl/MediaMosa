// $Id: 

START CHANGELOG:

Known issues;
- MediaMosa 2.1.x and lower is not PHP 5.3 compatible, we are working to get
  this fixed in 2.2 release.
- Dates are shown in the wrong timezone in admin/mediafile browser. However 
  dates on the status page are correct as long as you have enter the correct 
  timezone in Drupal 7 region settings or user timezone settings. This issue 
  will be fixed in 2.2.

Mediamosa 2.2.0
---------------
- Fixed saving webservice with client application in admin. (See ticket #315).
- Fixed unit test Still download/playproxy when using apache alias on /still
  (See ticket #313). 
- Fixed /mediafile/$asset_id/analyse call to return created job ID. (See ticket
  #320).
- Fixed missing mediafiles in asset view in admin. (See ticket #322).
- Added job_ids to several log messages (See ticket #214).
- Added pager to all stats pages and decreased items per page to 50 instead of 
  150 (See ticket (#225).
- Windows transcoding fix & first character fix (See vpcore Ticket 159).
- Extended asset/$asset_id/joblist with CQL search and now has limit and offset
  parameters. Limit is set to maximum of 200 jobs in result. Extended the
  admin documentation for this call for usage of the CQL call, see your
  MediaMosa admin on uri 
  /admin/mediamosa/browse/restcall/asset-%24asset_id-joblist/GET  
  (See ticket #267).
- Job for still analyse (See ticket #239).
- Introduction /collection/{id}/asset/count, and implements numofvideos in 
  /collection/{id} response (See ticket #204).
- Converted mediamosa_asset_mediafile_metadata to new setup where the values are
  stored as name -> value pairs allowing more flexible metadata on mediafiles
  (See ticket #290).
- Job search: item total count fix (See ticket #267).
- PA: Adding domains and realms produce failures fix (See VPCore ticket #172).
- Integrity check produces error fix (See VPCore ticket #177).
- Integrity check uses "nice" call, instead of "wget" (See VPCore ticket #177).
- User quota test fails in 32 bits systems bug fix.
- Support for 2 pass h264 encoding development (See MediaMosa ticket #264).

Other changes (not ticket related).
- During ticket #255, adding pager to stats, bug was found on the stats keyword
  saver. It also stored search on dates, which are not words. Bug fixed, stats
  now only stores words. Added stats unit test to make sure stats saving on
  search words works as intended.
- Fixed input errors in statistics dates (search words and other stats).
- Put some logging of still generation to debug level instead of normal.
- Still generation that is busy for black check now logs right text about 
  status.
- Logging message about ending still job while job in progress will now log
  message that its still running instead wrong ending message.
- DBUS REJECTED message will now return error 1600 in /login rest call instead
  of 601 OK message.
- ftp/create REST call will now also create the FTP home directory for the new
  user.
- Added extra tests for search on metadata dates.
- /user/user_id will now return quota even if user_id has no quota information.
  Old behavour would return invalid user Id error when no quota was available.
  But then you can never get quota information when you haven't uploaded
  anything yet.
- Fixed maxlength on title for collection creation, was unlimited.
- Max length is now shown correctly in REST calls browser.
- Fixed bug in mediamosa.profile where output of error messages was not 
  complete.
- Changed default mount point for windows in profile to \\ instead of //.
- Fixed weird bug where the stats cron job failed during a query because of
  linefeed char. Fixed by using mediamosa_db::db_query instead of db_query. 
- Fixed bug in admin where new collections where created with empty app_id.
- Added check to /assets on the asset_id array, will give notices when array
  in array was supplied.
- Fixed number of notices when tests where not completed (because of restarts).
- Made the tag rest parameter in /asset/asset_id/mediafile and 
  /mediafile/mediafile_id max. length 32 chars.
- Field 'transcode_profile_id' in mediamosa_asset_mediafile is converted to INT
  type instead of varchar(10).
- PHP function getimagesize() is now wrapped with mediamosa_io::getimagesize().
- Fixed documentation asset_id[] to asset_id in /asset REST call.
- Added 'changed', 'created' for assets to the CQL search. Use asset_changed and
  asset_created.
- acl/get_foreign_apps is now depricated and replaced by /acl/app
- Added /acl/app REST call. Returns listing of apps on which the current app has
  master-slave rights on.
- Upgraded drupal 7 core from alpha 4 to alpha 6.
- Fixed problem migration when asset_id_root was empty in the source code.
- Fixed settings page, alpha 6 of drupal 7 no longer sets up your settings page
  default values.
- Fixed mediamosa profile to work on alpha 6.
- Added title with version number during profile.
- Migrated alpha4 to alpha6 of drupal 7 core.
- Fixed form for mediamosa_connector, didn't work with alpha6.
- Alpha 6 introduced node->uri for default uri link for nodes, conflicted with
  uri setting of server nodes. Renamed uri to server_uri in database and code.
- Renamed module mediamosa_maintenance_status to 
  mediamosa_maintenance_simpletest.
- Created mediamosa_maintenance_status for new status page module.
- All simpletests urls, functions are moved to /admin/mediamosa/simpletests.
- Fixed problem with own http_request function now $db_prefix is removed from
  drupal.
- Fixed default profile to refect mediamosa.local as default domain.
- Number of typo and text changes in MediaMosa profile.
- Fixed bug in REST call /collection/$coll_id/delete where missing classname
  resulted in failure.
- Removed the 3 hour tab on simpletests page, is empty anyway.
- Added automatedsimpletest module to installation profile. 
- Fixed /acl/app to return only apps where you are allowed master/slave on.
- Fixed /acl/app in is_oai mode SQL error.

Mediamosa 2.1.5 (build 664)
---------------------------
- Default still image size is now 352x288, with no maintain aspect ratio (no 
  padding).
- Job/id/status: start time is now stored as UTC date, so unixtimestamp is
  not out of sync (See ticket #321).
- fixed several Windows transcoding related issues.
- <content_type> on a playrequest for flash is now also 'application/smil'.
  (see ticket #323).

Other changes (not ticket related)
- drupal_valid_test_ua() will now always return true; windows servers seem to
  have problem even though the settings files are the same.
- /ftp/user/create will now try to make the homedir of the user itself. 
  Previously it relied on proftpd (CreateHome), which did not always used the 
  correct uid/gid (dependend on the Proftpd version).
- Fix: orderby descending did not work when not using CQL.
- Transcoding support for underscore in parameters allowed (some windows encoder
  software use this)
- Image generation bug fixed, in some cases ffmpeg generated too many stills
  due to a changed parameter behaviour (vpadding).
   

Mediamosa 2.1.4 (build 628)
---------------------------
- Batchjobs history causes notice bug fix (Some batch job doesn't have 
  referenceId, just assetid) (See ticket #305).
- Content type application/smil now. (See ticket #262).
- Collection search with boolean value bug fix. (See ticket #304).
- .asx file is not downloadable with timing parameter - fix (See ticket #306).

Other changes (not ticket related)
- Changed unlink of tickets in simpletest into a test if ticket is gone.
- Added new REST call /assets for retrieving multiple assets.
- All filesize and file_exists checks now use clearcachestats to make sure the
  IO cache is up to date (SAN/NAS problems).
- Added slave option for search asset query to run on slave.
- Fixed saving of empty values in drop down select boxes in transcode profile
  admin.
- Fixed problem saving transcode profile without revision saving.
- Drupal 7 does not allow case-sensitive schema creation, this caused problems
  migrating database with IDs. Fixed by adding varbinary type to schema creation
  code of mediamosa. All IDs that are varchar and have the 32 character length
  are now varbinary type.
- Fixed problem migrating aut_object table when it contained double rows.
- Fixed notice in admin when view asset with no mediafiles.
- Job status REST call now returns correct started time for jobs as server time
  and not +0400.
- Fixed access to MediaMosa pages and related roles.

Mediamosa 2.1.3 (build 578)
---------------------------
- Transcoding progress fix (See ticket #297).
- Play response=metafile support for Wowza-server (See ticket 262).
- Order direction fix for collection. (See ticket #300).
- Fixed bulk upload format not allowed for video::action=delete (See ticket 
  #301).

Other changes (not ticket related)
- Made fix on simpletest to run on own database (when configured) so it 
  generate less binlog on mysql (about 25mb per test to 30k per test).
- Made core-hack patch on bootstrap.inc. Simpletests can not run on multiple 
  servers because of filedate and fileinode tests on local file. 
- Transcode profile ID is now visible in admin view and edit pages.


Mediamosa 2.1.2
---------------
- Renamed dummy titles of transcode profiles to their correct names. (See 
  mediamosa ticket #282).
- Added transcode profile_id in the admin interface. (See ticket #293). 
- Added explanation to the interface (client applications edit page) (See ticket
  #28).
- Changes of a transcode profile also updates the changed field. (See ticket 
  #276).
- added documentation for un-documented variables in the object code. (See 
  ticket #279).
- Log entries: page not found gives the the requested page. (See ticket #296)
- Removed the '< 7' check for asset search and updated documentation for it. 
  (See ticket #288) .
- New REST call for set ACL right for multiple mediafiles at once 
  (mediafile/acl) (See ticket #289).
- Upload with parameter still=normal was broken in v2. (See ticket #294).
- /asset/{id}/mediafile now only shows the slaved mediafiles (in case of an 
  slaved asset) (See ticket #232).
- fixed an error in /ftp in v.2. (See ticket #247).
- Transcode without padding. Added a new parameter to the transcode profile to 
  use in combination with maintain aspect ratio: (padding: yes, no) (See ticket
  #194).
- Added another mp4 (f4v, flash video) analyze fix. (See ticket #122).
- OAI: updated to Drupal 7 latests. (See ticket #299).


Other changes (not ticket related)
- Fixed problem retrieving user/$fav_user_id/favorites with /rest/$rest_id call.

Mediamosa 2.1.1
---------------
- Fixed asx not written or created (see MediaMosa ticket #188).
- Fixed asset search not to calculate item_count_total when limit is set to 6
  or lower (like in 1.7.x). Added 'calculate_total_count' flag to enable/disable
  calculation of 'item_count_total'. Default of this flag is 'false' when limit 
  is set to 6 or lower, 'true' when limit is higher than 6. (see MediaMosa 
  ticket #288).
- ACL master/slave fix. (see MediaMosa ticket #281).
- Fixed error message quota limit reached (see MediaMosa ticket #207).


Other changes (not ticket related)
- Fixed problem with quota test, didn't throw exception when it was reached.
- Added documentation information in the /rest restcall.
- Changed type of order_by from ALPHANUM to ALPHANUM_UNDERSCORE
- Added REST call /internal/acl/get_foreign_apps.
- Removed secret password from acl/get_foreign_apps function (its protected by
  internal password).
- Mutli typo fixed in comments (depricated to deprecated).
- Fixed migration; transcode profiles where not migrated.
- Changed the MediaMosa internal REST calls text on configure page to reflect
  that these settings are only used for REST calls during the CRON like status
  trigger and running the tests.
- Rewrote the status page unittest running. Now runs in a queue system and runs
  each test per minute (unless a test is still running).
- Status page now show which test is currently being tested (if any).
- Can now show the test data on each test that was run on the status page.
- Tests are now devided into 3 groups; 30 minutes, 180 minutes and 1440 minutes.
  The 180 minutes test group is empty atm.
- You can now re-run any test on the status page by putting it into the test 
  queue.
- Config page now includes settings for the status page. Including the interval
  lengths of the 3 tests groups.

Mediamosa 2.1.0
---------------
- Master-slave enhancements; Client applications can now select which other 
  client application may create master slave records to the other asset and
  mediafiles. (See MediaMosa ticket #28).
- Fixed download problem with filenames having invalid chars. (See MediaMosa 
  ticket #60).
- Clean up cancelled upload and transcode jobs test (See MediaMosa ticket #112).
- Updated transcode package to fix analyse/transcode problems (See MediaMosa 
  ticket #122).
- <is_empty_asset> = true, while there is a valid, usable mediafile (See
  MediaMosa ticket #165 and #167).
- Added support CQL for is_empty_asset (See MediaMosa ticket #180).
- is_streamable improvements; returns extra information about response in
  mediafile output;
  response_object_available <true / false>
  response_plain_available <true / false>
  response_metafile_available <true / false>
  and in asset output:
  has_streamable_mediafiles <true / false>
  (See MediaMosa ticket #187).
- Transcoding without padding fixed. (See MediaMosa ticket #194).
- Transcoding error (depends on system) (See MediaMosa ticket #209). 
- Fixed problem with deleting asset with jobs (See MediaMosa ticket #220).
- Banner text was updated (See MediaMosa ticket #222).
- Improved filehandling and file analyzer (See MediaMosa ticket #224).
- Fixed lame mp3 ffmpeg crash (See MediaMosa ticket #230).
- Fixed visible mediafiles in asset master/slave (See MediaMosa ticket #232).
- Fixed sort on mediafile_duration gives strange result. (See MediaMosa ticket 
  #233).
- Rebuild transcoding package (See MediaMosa ticket #235).
- bulk-ftp: licence -> license (See MediaMosa ticket #236).
- Added coll_id search to CQL. (See MediaMosa ticket #241).
- Added app_id search to CQL. (See MediaMosa ticket #241).
- Error message in /asset/{id}/collection. (See MediaMosa ticket #243).
- Error message in /collection/{id} (See MediaMosa ticket #244).
- /collection/{id}/asset doesn't exist (See MediaMosa ticket #245).
- Version does not exists. (See MediaMosa ticket #246).
- /asset/{id}/collection/count is broken (See MediaMosa ticket #249).
- 'aut_realm' parameter op een /asset call gaat fout (See MediaMosa ticket #252).
- /autorisation_group?limit=10 broken (See MediaMosa ticket #253).
- Assets of other apps visible (See MediaMosa ticket #254).
- /asset owner_id does not work (See 
  MediaMosa ticket #255).
- /asset/{id} post call now requires an 'owner_id'. (See MediaMosa ticket #257).
- Fixed is_empty_asset flag bug when asset no longer has mediafiles. (See 
  MediaMosa ticket #166).

Other changes (not ticket related)
- Play proxy call will now return the ticket id in result.
- Fixed number of query bugs in AUT / ACL code.
- Fixed job server where 2 rows where inserted while only one was allowed.
- Added unique index on mediamosa_job_server table to prevent multiple rows on
  same parent job.
- Added foreign key on mediamosa_job_server to mediamosa_job - job_id.
- Prevented possible divided by zero problems in job server. 
- asset_id_root in mediamosa_asset_mediafile table is now deprecated, will be 
  removed in later versions.
- parent_id in mediamosa_asset table is now deprecated, will be removed in later
  versions.
- is_original_file boolean in mediamosa_asset_mediafile table is deprecated, is
  replaced by mediafile_id_source.
- mediafile_id_source is now either NULL or points to its original mediafile.
- Fixed still generation call /mediafile/$mediafile/still. 
- Fixed play_restriction code. Typo with 'time_restriction_' prevented working
  of this code in the play proxy code. Seems to be old bug dating back from 1.0.
- Added /version REST call.
- Empty metadata values is no longer allowed. This made the search query a bit
  faster.
- Statistics in 1.x falsely created new statistics based on what some unittest
  was testing. F.e. the CQL unit test would generate new stats based on the
  searches during test and store them as normal stats. This no longer is
  a bug because of the sandbox environment of 2.x unittests.
- Some ffmpeg versions give value 'N/A' for bitrate. This caused database errors
  when trying to insert. Fixed by converting all required numeric values to 
  integers.
- Conversion of some queries where NULL was inserted into NON-NULL allowed 
  values is creating problems in DP7 database. This is because the old D6 code
  unintentially forced NULL values to be empty strings. This behavor can not be
  replicated in D7. Decided to put those columns in the database to allow NULL
  values instead. Statistics as example had owner_id and group_id as non-null.
- Fixed /collection which had asset_id as required, which is only when the call
  was made as /asset/{asset_id}/collection.
- Removed field 'locked' from asset and asset output(s). Field was not 
  documented or used.
- Header fields item_count_total and item_offset are always present in the 
  header while in 1.x these only where found for multi item results. In case of
  single item results, then item_count_total will always be 1 and item_offset 0.
- mediafile output will include new mediafile_id_source which can hold the ID of
  the original mediafile. When empty, then the mediafile is a original.
- /asset/$asset_id/joblist [GET] will now return 705 (empty result) when no jobs
  where found, instead of result ID 601 (OK).
- /asset/$asset_id/metadata [POST] will now return 705 (empty result) when no
  metadata was added.
- /asset/$asset_id/still/create [POST] will now return the job_id in the
  items response when success. 1.x only returned a 601 success result ID.
- The 'limit' REST parameter, where used in REST calls, is no longer required in
  any REST call, its default is 200.
- Date types uses ISO8601 norm; 'YYYY-MM-DD HH:MM:SS' or 'YYYY-MM-DDTHH:MM:SS'.
  Timezone specification in ISO8601 however is ignored for now. Its now allowed
  to enter '2007' or '2007-10' without triggering errors.
- Server IP/URL settings are now prepared/compliant for IPv7.
- MediaMosa is now UTF8 Compliant.
- asset/delete REST call now returns failures per failed asset and their cause.
- Fixed problems editing the transcode profile.
- Fixed migration problem on transcode profiles.
- REST call mediafile/$mediafile_id/uploadticket/create now also returns the
  ticket_id as separate value.
- Removed notices and warnings when mediafile's file on disk does not exists.
- Added new unit test listing under Browse tab.
- Added new development tool/module for testing REST calls.


MediaMosa.2.0
---------------
- Admin: Added mediamosa server browser.
- Admin: Added mediamosa REST call browser.
- Added MediaMosa Connector.
- Fixed asset / collection browser to use MediaMosa Connector.
- Was missing in 2.0.0 notes: vpx_version in XML response has been renamed to 
  version.


MediaMosa.0.0 (released as read-only)
---------------
- Port to drupal 7.
- VPX name use in code has been replaced with MediaMosa.
- Complete redesign and renaming of v1.x source code. All code has been moved 
  into (static) classes to support auto loading of classes in Drupal 7.
- New REST interface, class based.
- All medimosa code now support throw and catching of exceptions at high level, 
  enabling better error handling.
- Rewrite of all 1361 SQL queries into new PDO class support of Drupal 7. 
  Mediamosa now has own new DB layer between Drupal and Mediamosa code for 
  future expansion.
- REST calls are now moved from core code into drupal modules, also REST calls 
  no longer contain core code and only call core functions, seprating core code 
  from REST interface.
- Mediamosa 1 multiple database design combined and migrated to new single 
  Drupal database called mediamosa2. No longer required to switch databases in 
  code and has been removed.
- Jobserver database(s) design moved into single main mediamosa2 database. No 
  more multiple database required for multiple jobserver installations.
- Internal REST calls IP white listing removed, replaced with internal 
  authentication. Removed settings for old white listing from maintenance.
- New REST calls for browsing in the REST calls and retrieving specific 
  information about a single REST parameters and documentation. URL; /rest and 
  rest/[rest_id].
- Usage of new Drupal 7 Simpletest library; unittests are now sandboxed from 
  normal database.
- Internal calls now have access to all apps when app_id was not provided.
- GET / POST / URI variables now share the same scope.
- Redesign of the SAN/NAS globals/paths into static class 'storage'.
- Removed /internal/check_existence (function media_management_check_existence).
- parent_id of asset has been made deprecated. Will remove code supporting 
  parent_id from code in the future.
- is_original_file in mediafile has been made deprecated. Will still support 
  this flag in output in future versions, but will be removed in database in 
  future version.
- Introducing mediafile_id_source as replacement of is_original_file. This field
  is either NULL (is original) or points to the mediafile of which is its 
  original mediafile. 
- 1.7.3 migration to 2.0.0 database will now move child assets mediafiles to its
  root asset. This will make the database more reliable, faster and easier to
  maintain.
- Mediafile db field asset_id_root is now deprecated and will be removed in 
  future releases.
